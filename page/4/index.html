<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{&quot;hostname&quot;:&quot;jaguarjack.github.io&quot;,&quot;root&quot;:&quot;&#x2F;&quot;,&quot;images&quot;:&quot;&#x2F;images&quot;,&quot;scheme&quot;:&quot;Pisces&quot;,&quot;version&quot;:&quot;8.5.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:true,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:true,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:&quot;utterances&quot;,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null,&quot;activeClass&quot;:&quot;utterances&quot;},&quot;motion&quot;:{&quot;enable&quot;:false,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="JaguarJack&#39;s Blog">
<meta property="og:url" content="https://jaguarjack.github.io/page/4/index.html">
<meta property="og:site_name" content="JaguarJack&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="JaguarJack">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://jaguarjack.github.io/page/4/">



<script class="next-config" data-name="page" type="application/json">{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:true,&quot;isPost&quot;:false,&quot;lang&quot;:&quot;zh-CN&quot;,&quot;comments&quot;:&quot;&quot;,&quot;permalink&quot;:&quot;&quot;,&quot;path&quot;:&quot;page&#x2F;4&#x2F;index.html&quot;,&quot;title&quot;:&quot;&quot;}</script>

<script class="next-config" data-name="calendar" type="application/json">&quot;&quot;</script>
<title>JaguarJack's Blog</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="JaguarJack's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">JaguarJack's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">做人呢最重要的就是开心</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="JaguarJack"
      src="/./images/avatar.jpg">
  <p class="site-author-name" itemprop="name">JaguarJack</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">37</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/JaguarJack" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;JaguarJack" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/njphper@gmail.com" title="E-Mail → njphper@gmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>



          </div>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://jaguarjack.github.io/2018/05/08/go-byte-rune/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/./images/avatar.jpg">
      <meta itemprop="name" content="JaguarJack">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JaguarJack's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/08/go-byte-rune/" class="post-title-link" itemprop="url">go 的 []rune 和 []byte 区别</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-08 09:36:55" itemprop="dateCreated datePublished" datetime="2018-05-08T09:36:55Z">2018-05-08</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-16 01:05:39" itemprop="dateModified" datetime="2021-06-16T01:05:39Z">2021-06-16</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在看到 go 字符串的时候， 偶然看到 <strong>[]rune(s)</strong>, 它可以将字符串转化成 unicode 码点。那么它和 **[]byte(s)**有什么区别呢？来测试一下</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">first := <span class="string">&quot;fisrt&quot;</span></span><br><span class="line">fmt.Println([]<span class="keyword">rune</span>(first))</span><br><span class="line">fmt.Println([]<span class="keyword">byte</span>(first))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>[102 105 115 114 116]  //输出结果[]rune<br>[102 105 115 114 116]  //输出结果[]byte</p>
</blockquote>
<p>从输出来看， 没有任何区别， 作者不可能无缘无故弄出两个相同的东西，那么到底区别在哪里呢?翻看源码才知道</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// byte is an alias for uint8 and is equivalent to uint8 in all ways. It is</span></span><br><span class="line"><span class="comment">// used, by convention, to distinguish byte values from 8-bit unsigned</span></span><br><span class="line"><span class="comment">// integer values.</span></span><br><span class="line"><span class="keyword">type</span> <span class="keyword">byte</span> = <span class="keyword">uint8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// rune is an alias for int32 and is equivalent to int32 in all ways. It is</span></span><br><span class="line"><span class="comment">// used, by convention, to distinguish character values from integer values.</span></span><br><span class="line"><span class="keyword">type</span> <span class="keyword">rune</span> = <span class="keyword">int32</span></span><br></pre></td></tr></table></figure>
<p>原来是 <code>byte</code> 表示一个字节，<code>rune</code> 表示四个字节，那么就可以得出了结论了，来看一段代码，使用中文字符串</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">first := <span class="string">&quot;社区&quot;</span></span><br><span class="line">fmt.Println([]<span class="keyword">rune</span>(first))</span><br><span class="line">fmt.Println([]<span class="keyword">byte</span>(first))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>[31038 21306] //输出结果[]rune<br>[231 164 190 229 140 186]//输出结果[]byte</p>
</blockquote>
<p>这里也可以很清晰的看出这里的中文字符串每个占三个字节， 区别也就一目了然了。<br>说道这里正好可以提一下 Go 语言切割中文字符串，Go 的字符串截取和切片是一样的s[n:m]<strong>左闭右开</strong>的原则, 看一下例子</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s := <span class="string">&quot;golangcaff&quot;</span></span><br><span class="line">fmt.Println(s[:<span class="number">3</span>])</span><br></pre></td></tr></table></figure>
<blockquote>
<p>gol //输出, 看起来没问题， 顺利截取了三个字符</p>
</blockquote>
<p>如果换成中文的呢?来看一下例子</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s := <span class="string">&quot;截取中文&quot;</span></span><br><span class="line"><span class="comment">//试试这样能不能截取?</span></span><br><span class="line">fmt.Println(s[:<span class="number">2</span>])</span><br></pre></td></tr></table></figure>
<blockquote>
<p>?? //输出  在预料之中， 输出了常见的??</p>
</blockquote>
<p>那么该如何截取呢？这里就需要将中文利用 []rune 转换成 unicode 码点， 再利用 string 转化回去， 来看一下例子。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s := <span class="string">&quot;截取中文&quot;</span></span><br><span class="line"><span class="comment">//试试这样能不能截取?</span></span><br><span class="line">res := []<span class="keyword">rune</span>(s)</span><br><span class="line">fmt.Println(<span class="keyword">string</span>(res[:<span class="number">2</span>]))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>截取 //输出, 顺利截取了</p>
</blockquote>
<p>当然你可以使用 []byte 来截取， 但是这样你就需要知道你的中文字符到底占几个字节， 似乎这种方法不可取, 因为你无法得知。<br>为什么<strong>s[:n]<strong>无法直接截取呢， 通过实验我猜测如果直接截取的话，底层会将中文转化成</strong>[]byte</strong>， 而不是**[]rune**。你可以尝试一下:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s := <span class="string">&quot;截取中文&quot;</span></span><br><span class="line"><span class="comment">//试试这样能不能截取?</span></span><br><span class="line">fmt.Println(s[:<span class="number">3</span>])</span><br></pre></td></tr></table></figure>
<blockquote>
<p>截 //输出</p>
</blockquote>
<p>当然这只是我猜测的， 没有看源码具体实现。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://jaguarjack.github.io/2018/04/17/vim-autocomplent/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/./images/avatar.jpg">
      <meta itemprop="name" content="JaguarJack">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JaguarJack's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/04/17/vim-autocomplent/" class="post-title-link" itemprop="url">Vim 自动补全集成方案</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-04-17 10:14:55" itemprop="dateCreated datePublished" datetime="2018-04-17T10:14:55Z">2018-04-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-16 01:05:39" itemprop="dateModified" datetime="2021-06-16T01:05:39Z">2021-06-16</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">服务器运维</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="VIM"><a href="#VIM" class="headerlink" title="VIM"></a>VIM</h1><p>准备阶段， 一台空的centos7系统。如果你所使用的环境不是初始化的服务器的话， 以下请适当安装需要的依赖。安装这个果然是很难啊，我不得不说太难了， 翻阅了很多 资料， 各种google。 尤其是在centos上， 简直了， 如果是乌班图Ubuntu的话， 可能还好一点，因为在编译的YcmCompleteMe的时候， 自动下载的clang是Ubuntu的，所以之后需要centos需要自己编译安装</p>
<h2 id="安装一些基础的依赖"><a href="#安装一些基础的依赖" class="headerlink" title="安装一些基础的依赖"></a>安装一些基础的依赖</h2><blockquote>
<p>yum -y update<br>yum -y install git<br>yum -y install ncurses-devel<br>yum install python-devel libffi-devel graphviz-devel elfutils-libelf-devel readline-devel libedit-devel libxml2-devel protobuf-devel gtext-devel doxygen swig -y</p>
</blockquote>
<h2 id="升级gcc-amp-vim"><a href="#升级gcc-amp-vim" class="headerlink" title="升级gcc &amp; vim"></a>升级gcc &amp; vim</h2><blockquote>
<p>yum install centos-release-scl -y<br>yum install devtoolset-3-toolchain -y<br>yum install gcc-c++<br>scl enable devtoolset-3 bash</p>
</blockquote>
<p>安装最新版vim， 最好是8.0以上， 不然会出现问题。<br>vim //查看你的vim版本</p>
<blockquote>
<p>git clone <a target="_blank" rel="noopener" href="https://github.com/vim/vim.git">https://github.com/vim/vim.git</a><br>cd vim/src/<br>./configure –with-features=huge -enable-pythoninterp –with-python-config-dir=/usr/lib/python2.7/config<br>make &amp;&amp; make install</p>
</blockquote>
<h2 id="安装Vundle-插件管理"><a href="#安装Vundle-插件管理" class="headerlink" title="安装Vundle 插件管理"></a>安装Vundle 插件管理</h2><blockquote>
<p>git clone <a target="_blank" rel="noopener" href="https://github.com/VundleVim/Vundle.vim.git">https://github.com/VundleVim/Vundle.vim.git</a> ~/.vim/bundle/Vundle.vim //提示版本可能会更新， 请于github查看<br>vim ~/.vimrc  //没有就将下面粘贴进去， 如果有错误， 请到github获取官方配置</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> nocompatible              <span class="string">&quot; be iMproved, required</span></span><br><span class="line"><span class="string">filetype off                  &quot;</span> required=</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> nocompatible              <span class="string">&quot; be iMproved, required</span></span><br><span class="line"><span class="string">filetype off                  &quot;</span> required</span><br><span class="line"><span class="string">&quot; set the runtime path to include Vundle and initialize</span></span><br><span class="line"><span class="string">set rtp+=~/.vim/bundle/Vundle.vim</span></span><br><span class="line"><span class="string">call vundle#begin()</span></span><br><span class="line"><span class="string">&quot;</span> alternatively, pass a path <span class="built_in">where</span> Vundle should install plugins</span><br><span class="line"><span class="string">&quot;call vundle#begin(&#x27;~/some/path/here&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;</span> <span class="built_in">let</span> Vundle manage Vundle, required</span><br><span class="line">Plugin <span class="string">&#x27;VundleVim/Vundle.vim&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot; The following are examples of different formats supported.</span></span><br><span class="line"><span class="string">&quot;</span> Keep Plugin commands between vundle<span class="comment">#begin/end.</span></span><br><span class="line"><span class="string">&quot; plugin on GitHub repo</span></span><br><span class="line"><span class="string">Plugin &#x27;tpope/vim-fugitive&#x27;</span></span><br><span class="line"><span class="string">&quot;</span> plugin from http://vim-scripts.org/vim/scripts.html</span><br><span class="line"><span class="string">&quot; Plugin &#x27;L9&#x27;</span></span><br><span class="line"><span class="string">&quot;</span> Git plugin not hosted on GitHub</span><br><span class="line">Plugin <span class="string">&#x27;git://git.wincent.com/command-t.git&#x27;</span></span><br><span class="line"><span class="string">&quot; git repos on your local machine (i.e. when working on your own plugin)</span></span><br><span class="line"><span class="string">&quot;</span> Plugin <span class="string">&#x27;file:///home/gmarik/path/to/plugin&#x27;</span></span><br><span class="line"><span class="string">&quot; The sparkup vim script is in a subdirectory of this repo called vim.</span></span><br><span class="line"><span class="string">&quot;</span> Pass the path to <span class="built_in">set</span> the runtimepath properly.</span><br><span class="line">Plugin <span class="string">&#x27;rstacruz/sparkup&#x27;</span>, &#123;<span class="string">&#x27;rtp&#x27;</span>: <span class="string">&#x27;vim/&#x27;</span>&#125;</span><br><span class="line"><span class="string">&quot; Install L9 and avoid a Naming conflict if you&#x27;ve already installed a</span></span><br><span class="line"><span class="string">&quot;</span> different version somewhere <span class="keyword">else</span>.</span><br><span class="line"><span class="string">&quot; Plugin &#x27;ascenator/L9&#x27;, &#123;&#x27;name&#x27;: &#x27;newL9&#x27;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;</span> All of your Plugins must be added before the following line</span><br><span class="line">call vundle<span class="comment">#end()            &quot; required</span></span><br><span class="line">filetype plugin indent on    <span class="string">&quot; required</span></span><br><span class="line"><span class="string">&quot;</span> To ignore plugin indent changes, instead use:</span><br><span class="line"><span class="string">&quot;filetype plugin on</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string">&quot; Brief help</span></span><br><span class="line"><span class="string">&quot;</span> :PluginList       - lists configured plugins</span><br><span class="line"><span class="string">&quot; :PluginInstall    - installs plugins; append `!` to update or just :PluginUpdate</span></span><br><span class="line"><span class="string">&quot;</span> :PluginSearch foo - searches <span class="keyword">for</span> foo; append `!` to refresh <span class="built_in">local</span> cache</span><br><span class="line"><span class="string">&quot; :PluginClean      - confirms removal of unused plugins; append `!` to auto-approve removal</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string">&quot; see :h vundle for more details or wiki for FAQ</span></span><br><span class="line"><span class="string">&quot;</span> Put your non-Plugin stuff after this line</span><br></pre></td></tr></table></figure>

<blockquote>
<p>vim<br>:PluginInstall //安装插件</p>
</blockquote>
<h2 id="安装YouCompleteMe"><a href="#安装YouCompleteMe" class="headerlink" title="安装YouCompleteMe"></a>安装YouCompleteMe</h2><blockquote>
<p>vim ~/.vimrc</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">all vundle<span class="comment">#begin()  </span></span><br><span class="line">. . .</span><br><span class="line">Plugin <span class="string">&#x27;Valloric/YouCompleteMe’ //加入 YouCompleteMe</span></span><br><span class="line"><span class="string">. . .  </span></span><br><span class="line"><span class="string">call vundle#end()</span></span><br></pre></td></tr></table></figure>

<p>继续vim 然后:PluginInstall</p>
<h2 id="升级Cmake"><a href="#升级Cmake" class="headerlink" title="升级Cmake"></a>升级Cmake</h2><blockquote>
<p>wget <a target="_blank" rel="noopener" href="https://cmake.org/files/v3.11/cmake-3.11.3.tar.gz">https://cmake.org/files/v3.11/cmake-3.11.3.tar.gz</a><br>tar xvf cmake-3.11.3.tar.gz &amp;&amp; cd cmake-3.11.3/<br>./bootstrap<br>gmake<br>gmake install<br>//查看版本<br>/usr/local/bin/cmake –version<br>//移除自带的版本<br>yum remove cmake -y<br>//新建软连接<br>ln -s /usr/local/bin/cmake /usr/bin/</p>
</blockquote>
<p>到这里第一部分算是完成了， 千万不能立即编译YcmCompleteMe, 因为centos根本就不会自动下载clang所以这里我们需要自己安装， 过程非常漫长， 要等待很长时间， 所以务必耐心等待</p>
<h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><p><a target="_blank" rel="noopener" href="http://releases.llvm.org/download.html#6.0.0" title="http://releases.llvm.org/download.html#6.0.0">http://releases.llvm.org/download.html#6.0.0</a>首先到这个页面Source下面除了**LLVM Test Suite (.sig)**以外的全部下载下来</p>
<h2 id="准备-LLVM-源码"><a href="#准备-LLVM-源码" class="headerlink" title="准备 LLVM 源码"></a>准备 LLVM 源码</h2><p>LLVM 的各个子组件必须放在 LLVM 源码的固定位置，使用固定名称。<br>首先解压 llvm-6.0.0.src.tar.xz，生成目录 llvm-6.0.0.src<br>解压 tar.xz 文件使用 tar Jxvf filename.tar.xz -C 指定路径<br>解压文件到指定文件夹tar Jxvf filename.tar.xz -C 指定路径<br><strong>mv 源文件 新文件名</strong>来修改文件名</p>
<p><strong>放在 llvm-6.0.0.src/tools 目录下的组件：</strong></p>
<blockquote>
<p>解压 cfe-6.0.0.src.tar.xz，重命名为 llvm-6.0.0.src/tools/clang<br>解压 lld-6.0.0.src.tar.xz，重命名为 llvm-6.0.0.src/tools/lld<br>解压 polly-6.0.0.src.tar.xz，重命名为 llvm-6.0.0.src/tools/polly<br>解压 lldb-6.0.0.src.tar.xz，重命名为 llvm-6.0.0.src/tools/lldb</p>
</blockquote>
<p><strong>放在 llvm-6.0.0.src/projects 目录下的组件：</strong></p>
<blockquote>
<p>解压 openmp-6.0.0.src.tar.xz，重命名为 llvm-6.0.0.src/projects/openmp<br>解压 libcxx-6.0.0.src.tar.xz，重命名为 llvm-6.0.0.src/projects/libcxx<br>解压 libcxxabi-6.0.0.src.tar.xz，重命名为 llvm-6.0.0.src/projects/libcxxabi<br>解压 libunwind-6.0.0.src.tar.xz，重命名为 llvm-6.0.0.src/projects/libunwind<br>解压 compiler-rt-6.0.0.src.tar.xz，重命名为 llvm-6.0.0.src/projects/compiler-rt</p>
</blockquote>
<p><strong>clang 的子组件：</strong></p>
<blockquote>
<p>解压 clang-tools-extra-6.0.0.src.tar.xz，重命名为 llvm-6.0.0.src/tools/clang/tools/extra</p>
</blockquote>
<h2 id="使用-CMake-生成-Makefile"><a href="#使用-CMake-生成-Makefile" class="headerlink" title="使用 CMake 生成 Makefile"></a>使用 CMake 生成 Makefile</h2><blockquote>
<ol>
<li>cd llvm-6.0.0.src //首先进入解压的目录</li>
<li>mkdir build &amp;&amp; cd build</li>
<li>cmake .. -DLLVM_OPTIMIZED_TABLEGEN=ON -DLLVM_INCLUDE_DOCS=OFF -DLLVM_ENABLE_RTTI=ON -DLLVM_ENABLE_EH=ON -DLLVM_INSTALL_UTILS=ON -DWITH_POLLY=ON -DLINK_POLLY_INTO_TOOLS=ON -DLLVM_TARGETS_TO_BUILD=X86 -DLIBOMP_ARCH=x86_64 -DBUILD_SHARED_LIBS=ON -DLIBOMP_ENABLE_SHARED=ON -DLLVM_ENABLE_LIBCXX=ON -DLLDB_RELOCATABLE_PYTHON=ON -DLLVM_ENABLE_FFI=ON -DCMAKE_BUILD_TYPE=Release -DCLANG_DEFAULT_CXX_STDLIB=libc++ -DCLANG_DEFAULT_RTLIB=compiler-rt -DCLANG_INCLUDE_TESTS=OFF -DENABLE_LINKER_BUILD_ID=ON -DENABLE_X86_RELAX_RELOCATIONS=ON -DLIBCXXABI_INCLUDE_TESTS=OFF -DLIBCXX_INCLUDE_BENCHMARKS=OFF -DLIBCXX_INCLUDE_TESTS=OFF -DLIBOMP_TSAN_SUPPORT=ON -DLLDB_BUILD_INTEL_PT=OFF -DLLDB_INCLUDE_TESTS=OFF -DLLVM_ENABLE_OCAMLDOC=OFF -DLLVM_INCLUDE_EXAMPLES=OFF -DLLVM_INCLUDE_GO_TESTS=OFF -DLLVM_INCLUDE_TESTS=OFF -DLLVM_INSTALL_BINUTILS_SYMLINKS=ON -DLLVM_TOOL_LLGO_BUILD=ON -DLLVM_TOOL_PARALLEL_LIBS_BUILD=ON -DLLVM_ENABLE_PIC=ON -DLIBUNWIND_ENABLE_SHARED=OFF -DLIBCXX_ENABLE_PEDANTIC=ON -DLIBCXXABI_LIBDIR_SUFFIX=64 -DLIBCXX_LIBDIR_SUFFIX=64 -DLIBUNWIND_LIBDIR_SUFFIX=64 -DLLVM_LIBDIR_SUFFIX=64</li>
</ol>
</blockquote>
<h2 id="编译-时间较长，-注意等待"><a href="#编译-时间较长，-注意等待" class="headerlink" title="编译(时间较长， 注意等待)"></a>编译(时间较长， 注意等待)</h2><p>make -j4 // -j4 表示并发执行 4 个任务，这个数字指定 CPU 核心数为佳<br>make install</p>
<h2 id="在编译阶段遇到的问题"><a href="#在编译阶段遇到的问题" class="headerlink" title="在编译阶段遇到的问题"></a>在编译阶段遇到的问题</h2><p>这里的问题是以我本身环境所决定， 具体的如果你遇到请自行搜索查阅</p>
<h2 id="内存不足"><a href="#内存不足" class="headerlink" title="内存不足"></a>内存不足</h2><p>这里如果你的机器内存太小， 比如我的内存只有1G， 所以需要借助swap<br>dd if=/dev/zero of=/swapfile bs=64M count=16 //bs代表块大小， count需要多少块<br>mkswap /swapfile<br>swapon /swapfile<br>// 编译结束以后一定要删除<br>swapoff /swapfile<br>rm /swapfile</p>
<h2 id="遇到未找到的问题"><a href="#遇到未找到的问题" class="headerlink" title="遇到未找到的问题"></a>遇到未找到的问题</h2><p><strong>/usr/bin/ld: cannot find -lgtest</strong><br>如果是遇到这个问题， 是越少googletest框架, 参考<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/13513905/how-to-setup-googletest-as-a-shared-library-on-linux" title="https://stackoverflow.com/questions/13513905/how-to-setup-googletest-as-a-shared-library-on-linux">https://stackoverflow.com/questions/13513905/how-to-setup-googletest-as-a-shared-library-on-linux</a></p>
<blockquote>
<p>git clone <a target="_blank" rel="noopener" href="https://github.com/google/googletest.git">https://github.com/google/googletest.git</a><br>cd googletest<br>cmake -DBUILD_SHARED_LIBS=ON .<br>make<br>cp -a googletest/include/gtest /usr/include<br>cp -a googlemock/gtest/libgtest_main.so googlemock/gtest/libgtest.so /usr/lib/</p>
</blockquote>
<h2 id="遇到Can’t-locate-Data-Dumper-pm-in-INC…问题"><a href="#遇到Can’t-locate-Data-Dumper-pm-in-INC…问题" class="headerlink" title="遇到Can’t locate Data/Dumper.pm in @INC…问题"></a>遇到Can’t locate Data/Dumper.pm in @INC…问题</h2><blockquote>
<p>wget <a target="_blank" rel="noopener" href="http://www.cpan.org/modules/by-module/Data/Data-Dumper-2.154.tar.gz">http://www.cpan.org/modules/by-module/Data/Data-Dumper-2.154.tar.gz</a><br>tar xvzf Data-Dumper-2.154.tar.gz<br>cd Data-Dumper-2.121<br>perl Makefile.PL<br>make<br>make install<br> //如果遇到Can’t locate ExtUtils/MakeMaker.pm…该错误<br> yum install perl-ExtUtils-CBuilder perl-ExtUtils-MakeMaker cpan</p>
</blockquote>
<h2 id="下面就是编译YcmCompleteMe"><a href="#下面就是编译YcmCompleteMe" class="headerlink" title="下面就是编译YcmCompleteMe"></a>下面就是编译YcmCompleteMe</h2><p>由于你不是直接编译， 而是通过另外编译Clang, 所以不能使用install.sh脚本。</p>
<blockquote>
<p>mkdir ~/ycm_build<br>cd ~/ycm_build<br>cmake -G “Unix Makefiles” -DEXTERNAL_LIBCLANG_PATH=/usr/local/lib64/libclang.so . ~/.vim/bundle/YouCompleteMe/third_party/ycmd/cpp<br>// 这里需要你自己查找机器libclang的地方， find / -name “libclang”</p>
</blockquote>
<h2 id="生成ycm-core"><a href="#生成ycm-core" class="headerlink" title="生成ycm_core"></a>生成ycm_core</h2><blockquote>
<p>cmake –build . –target ycm_core –config Release</p>
</blockquote>
<p>至此，YouCompleteMe已经算是安装成功！<br>注意：这时候，ycm_build目录可以删除啦！</p>
<blockquote>
<p>安装成功后，ycm_build以及ycm_temp目录都可以删除，不影响YouCompleteMe插件的使用。</p>
</blockquote>
<p>如果vim 出现<br><strong>NoExtraConfDetected: No .ycm_extra_conf.py file detected, so no compile flags are available. Thus no semantic support for C/C++/ObjC/ObjC++. Go READ THE DOCS <em>NOW</em>, DON’T file a bug r…</strong><br>到<a target="_blank" rel="noopener" href="https://github.com/Valloric/ycmd/blob/master/cpp/ycm/.ycm_extra_conf.py" title="https://github.com/Valloric/ycmd/blob/master/cpp/ycm/.ycm_extra_conf.py">https://github.com/Valloric/ycmd/blob/master/cpp/ycm/.ycm_extra_conf.py</a>该页面下载， 然后修改进行修改<br>cd  ~/.vim/bundle/YouCompleteMe<br>查看有没有cpp文件夹， 没有就创建mkdir cpp/ycm, 然后将下载.ycm_extra_conf.py放进该文件夹下, 然后编辑</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;-isystem&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;/usr/include&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;-isystem&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;/usr/include/c++/4.8.5&#x27;</span>,//注意这是你自己版本</span><br><span class="line"><span class="string">&#x27;-isystem&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;/usr/include&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;/usr/include/x86_64-linux-gnu/c++&#x27;</span>, //这个也是你机器实际的位置</span><br></pre></td></tr></table></figure>

<p>再次打开 .vimrc 配置YCM，如下：</p>
<blockquote>
<p>“YouCompleteMe<br>let g:ycm_global_ycm_extra_conf=’~/.vim/bundle/YouCompleteMe/cpp/ycm/.ycm_extra_conf.py’</p>
</blockquote>
<p>这样就算完成了， 可以自动补全了， 安装这个真的太费劲了， 简直不能忍受啊。 真的太繁琐了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://jaguarjack.github.io/2017/06/16/docker-swapon/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/./images/avatar.jpg">
      <meta itemprop="name" content="JaguarJack">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JaguarJack's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/06/16/docker-swapon/" class="post-title-link" itemprop="url">docker 遇到swapon failed Operation not permitted</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-06-16 10:43:51" itemprop="dateCreated datePublished" datetime="2017-06-16T10:43:51Z">2017-06-16</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-16 01:05:39" itemprop="dateModified" datetime="2021-06-16T01:05:39Z">2021-06-16</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">工具笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在安装phalcon的时候遇到内存不足的问题，需要swap增加内存，可是在docker里面遇到</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swapon failed: Operation not permitted</span><br></pre></td></tr></table></figure>

<p>该问提百思不得其姐，最后在docker官网找到了解释，最后说一下，搜索还是google靠谱</p>
<blockquote>
<p>Hi,<br>As each running docker container uses the host Kernel, they also use the memory and swap of the host. If this is a one of requirement its better to increase the host swap space.<br>If you want to still add swap from the container you have two options.<br>Run container in privileged mode<br>In this case you will have to run the container with –privileged option.</p>
</blockquote>
<p>Example</p>
<p>docker run -it –rm –privileged centos:6<br>Running container with privileged mode gives container full privilege on the host. If you read the manpage of swapon you can see that for swapon to run the process should have CAP_SYS_ADMIN capability. In Docker you can add a particular capability selectively to the container using the –cap-add argument.</p>
<p>Example</p>
<p>docker run -it –rm –cap-add SYS_ADMIN centos:6<br>If you run the container in either of the above two modes you can achieve what you are trying.<br>Now the problem with this approach is , when you create swap inside the container and start using that, its actually the Host Kernel that is using it, as a result when you exit the container without a swapoff the host kernel will be still using the file, and you wont get a clean exit of the container. You will see a dead status for the container.</p>
<blockquote>
<p>嗨，<br>由于每个运行的docker容器都使用主机内核，它们还使用主机的内存和交换。如果这是要求更好的增加主机交换空间的一个。<br>如果你想从容器中添加交换，你有两个选择。<br>以特权模式运行容器<br>在这种情况下，您将必须使用–privileged选项运行容器。<br>＃示例<br>docker run -it –rm –privileged centos：6<br>运行具有特权模式的容器可以为主机提供容器完整权限。如果您阅读swapon的联机帮助页面，您可以看到，对于swapon来运行该进程应该具有CAP_SYS_ADMIN功能。在Docker中，您可以使用-cap-add参数有选择地向容器添加特定的功能。<br>＃示例<br>docker run -it –rm –cap-add SYS_ADMIN centos：6<br>如果您以上述两种模式运行容器，您可以实现您正在尝试的功能。<br>现在，这种方法的问题是，当您在容器内创建交换并开始使用它时，实际上是使用它的主机内核，因此当您退出容器而不进行swapoff时，主机内核将仍然使用该文件，你不会得到一个干净的出口的容器。您将看到容器的死亡状态。</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://jaguarjack.github.io/2017/06/12/docker-private-repo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/./images/avatar.jpg">
      <meta itemprop="name" content="JaguarJack">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JaguarJack's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/06/12/docker-private-repo/" class="post-title-link" itemprop="url">docker 建立私有仓库</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-06-12 10:47:41" itemprop="dateCreated datePublished" datetime="2017-06-12T10:47:41Z">2017-06-12</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-16 01:05:39" itemprop="dateModified" datetime="2021-06-16T01:05:39Z">2021-06-16</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">工具笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>有时候docker拉镜像的确有很慢哈，官方也考虑到这一点了，所以呢，允许你建立自己的私有仓库，以下只是简单创建，没有考虑安全性问题</p>
<p>三步骤</p>
<p>拉取</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull registry</span><br></pre></td></tr></table></figure>

<p>根据下载的镜像创建并运行一个容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 5000:5000 -v /data/registry:/var/lib/registry --name registry -d registry</span><br></pre></td></tr></table></figure>

<ul>
<li>-p选项用于将宿主机的端口映射到容器的端口，这样就可以通过宿主机的地址访问容器服务</li>
<li>-v选项用于将宿主机的目录挂在到容器的目录，便于直接在宿主机上查看上传的镜像</li>
</ul>
<p>访问 <a target="_blank" rel="noopener" href="http://xxx.xxxx.xxx:5000/v2%EF%BC%8C%E4%BD%A0%E4%BC%9A%E5%9C%A8%E7%BD%91%E9%A1%B5%E7%9C%8B%E5%88%B0%E4%B8%80%E4%B8%AA%7B%7D%EF%BC%8C%E8%AF%B4%E6%98%8E%E5%BB%BA%E7%AB%8B%E6%88%90%E5%8A%9F%E4%BA%86">http://xxx.xxxx.xxx:5000/v2，你会在网页看到一个{}，说明建立成功了</a></p>
<p>上传镜像到私有仓库</p>
<p>通过 <code>docker tag</code> 将该镜像标志为要推送到私有仓库</p>
<p><code>docker tag</code> 镜像名[:标签] 镜像仓库服务器地址/命名空间/镜像发布名:发布标签，<br>运行 <code>docker pus</code> 将镜像 <code>push</code> 到我们的私有仓库中</p>
<p><code>docker push</code> 镜像仓库服务器地址/命名空间/镜像发布名:发布标签<br>本例中，我们操作如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker tag php xxx.xxx.xxx:5000/php</span><br><span class="line">docker push xxx.xxx.xxx:5000/php</span><br></pre></td></tr></table></figure>

<p>如果遇到一下问题</p>
<blockquote>
<p>http: server gave HTTP response to HTTPS client</p>
</blockquote>
<p>对应的解决方法</p>
<p>请修改改文件 <code>/etc/docker/daemon.json</code></p>
<blockquote>
<p>{ “insecure-registries”:[“myregistry.example.com:5000”] }</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker.service</span><br><span class="line"></span><br><span class="line">docker restart registry</span><br></pre></td></tr></table></figure>

<p>然后在此 <code>push</code>,完毕后</p>
<p>然后在 <code>/data/registry/docker/registry/v2/repositories/php</code> 查看到改该镜像<br>以上假设是在某台服务器上的操作，现在另外一台服务准备拉取镜像,不经过官方的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull xxx.xxx.xxx:5000/php</span><br></pre></td></tr></table></figure>

<p>可能会出现上面同样的错误解决办法是一样的</p>
<p>http: server gave HTTP response to HTTPS client</p>
<p>这样就可以了</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://jaguarjack.github.io/2017/05/03/ffmpeg/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/./images/avatar.jpg">
      <meta itemprop="name" content="JaguarJack">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JaguarJack's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/03/ffmpeg/" class="post-title-link" itemprop="url">安装ffmpeg给视频添加水印</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-03 11:09:36" itemprop="dateCreated datePublished" datetime="2017-05-03T11:09:36Z">2017-05-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-16 01:05:39" itemprop="dateModified" datetime="2021-06-16T01:05:39Z">2021-06-16</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">工具笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="FFMPEG"><a href="#FFMPEG" class="headerlink" title="FFMPEG"></a>FFMPEG</h2><p>CentOS 7，具有完全 root 访问权限。</p>
<p>注意：此方法的 <code>ffmpeg</code> 安装也适用于 <code>centos 6.x，cpanel，directadmin</code>。<br>从 repo 导入 GPG 密钥：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm --import http://packages.atrpms.net/RPM-GPG-KEY.atrpms</span><br></pre></td></tr></table></figure>

<h3 id="安装-ATRPMS-Repo"><a href="#安装-ATRPMS-Repo" class="headerlink" title="安装 ATRPMS Repo:"></a>安装 ATRPMS Repo:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh http://dl.atrpms.net/all/atrpms-repo-6-7.el6.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p><code>Ffmpeg</code> 需要 <code>libdc1394-devel</code>，它在 <code>epel</code> 库中可用。 执行以下命令安装 <code>epel</code> 存储库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-9.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>从 <code>ATRPMS</code> 安装 <code>FFMpeg</code> 存储库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y --enablerepo = atrpms install ffmpeg ffmpeg-devel</span><br></pre></td></tr></table></figure>

<h2 id="验证ffmpeg版本："><a href="#验证ffmpeg版本：" class="headerlink" title="验证ffmpeg版本："></a>验证ffmpeg版本：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -version</span><br><span class="line">ffmpeg version 2.2.1</span><br><span class="line">built on Jun 17 2014 01:25:46 with gcc 4.8.2 (GCC) 20140120 (Red Hat 4.8.2-16)</span><br><span class="line">configuration: --prefix=/usr --libdir=/usr/lib64 --shlibdir=/usr/lib64 --mandir=/usr/share/man --enable-shared --enable-runtime-cpudetect --enable-gpl --enable-version3 --enable-postproc --enable-avfilter --enable-pthreads --enable-x11grab --enable-vdpau --disable-avisynth --enable-frei0r --enable-libdc1394 --enable-libgsm --enable-libmp3lame --enable-libnut --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-libopenjpeg --enable-librtmp --enable-libspeex --enable-libtheora --enable-libvorbis --enable-libvpx --enable-libx264 --enable-libxavs --enable-libxvid --extra-cflags=<span class="string">&#x27;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC&#x27;</span> --disable-stripping</span><br><span class="line">libavutil      52. 66.100 / 52. 66.100</span><br><span class="line">libavcodec     55. 52.102 / 55. 52.102</span><br><span class="line">libavformat    55. 33.100 / 55. 33.100</span><br><span class="line">libavdevice    55. 10.100 / 55. 10.100</span><br><span class="line">libavfilter     4.  2.100 /  4.  2.100</span><br><span class="line">libswscale      2.  5.102 /  2.  5.102</span><br><span class="line">libswresample   0. 18.100 /  0. 18.100</span><br><span class="line">libpostproc    52.  3.100 / 52.  3.100</span><br></pre></td></tr></table></figure>

<p>使用方法摘自国外博客，有兴趣的可以看看<br><a target="_blank" rel="noopener" href="http://ksloan.net/watermarking-videos-from-the-command-line-using-ffmpeg-filters/">FFMPEG 博客</a></p>
<p>watermarking-videos-from-the-command-line-using-ffmpeg-filters/<br>在某些情况下，您可能不知道要加入水印的视频的确切尺寸。 幸运的是，有一些变量可以用来更好地定位水印，这取决于视频的大小。 这些变量包括：</p>
<ul>
<li>main_h - 视频的高度</li>
<li>main_w - 视频的宽度</li>
<li>overlay_h - 重叠广告的高度</li>
<li>overlay_w - 重叠式广告的宽度</li>
</ul>
<p>使用这些变量，我们可以将水印定位在视频的中心，如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i birds.mp4 -i watermark.png</span><br><span class="line">-filter_complex <span class="string">&quot;overlay=x=(main_w-overlay_w)/2:y=(main_h-overlay_h)/2&quot;</span> birds2.mp4</span><br></pre></td></tr></table></figure>

<p>如果我们想要为剪辑添加品牌或水印，但不覆盖现有视频，我们可以使用 <code>pad</code> 过滤器为剪辑添加一些填充，然后将我们的水印放在填充上，如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i birds.mp4 -i watermark2.png</span><br><span class="line">-filter_complex <span class="string">&quot;pad=height=ih+40:color=#71cbf4,overlay=(main_w-overlay_w)/2:main_h-overlay_h&quot;</span></span><br><span class="line">birds3.mp4</span><br></pre></td></tr></table></figure>

<p>一旦你开始得到这个的概念之后，你甚至可以让你的水印动起来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i birds.mp4 -i watermark.png</span><br><span class="line">-filter_complex <span class="string">&quot;overlay=&#x27;if(gte(t,1), -w+(t-1)*200, NAN)&#x27;:(main_h-overlay_h)/2&quot;</span> birds4.mp4</span><br></pre></td></tr></table></figure>

<p>如果遇到这个 <code>error</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The encoder <span class="string">&#x27;aac&#x27;</span> is experimental but experimental codecs are not enabled, add <span class="string">&#x27;-strict -2&#x27;</span> <span class="keyword">if</span> you want to use it.</span><br></pre></td></tr></table></figure>

<p>那就添加个参数吧</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i yii.mp4 -i logo.jpg -strict -2 -filter_complex <span class="string">&quot;overlay=x=(main_w-overlay_w)/2:y=(main_h-overlay_h)/2&quot;</span> birds2.mp4</span><br></pre></td></tr></table></figure>

<p>如果遇到其他错误，就去查查资料吧</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://jaguarjack.github.io/2017/05/03/webupload-video/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/./images/avatar.jpg">
      <meta itemprop="name" content="JaguarJack">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JaguarJack's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/03/webupload-video/" class="post-title-link" itemprop="url">webupload 实现分片上传视频</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-03 11:07:17" itemprop="dateCreated datePublished" datetime="2017-05-03T11:07:17Z">2017-05-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-16 01:05:39" itemprop="dateModified" datetime="2021-06-16T01:05:39Z">2021-06-16</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">工具笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>前端代码，不一定适合你的项目要求，可以做一定量修改!</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fileMd5;</span><br><span class="line"><span class="comment">//监听分块上传过程中的三个时间点  </span></span><br><span class="line">WebUploader.Uploader.register(&#123;  </span><br><span class="line">    <span class="string">&quot;before-send-file&quot;</span>:<span class="string">&quot;beforeSendFile&quot;</span>,  </span><br><span class="line">    <span class="string">&quot;before-send&quot;</span>:<span class="string">&quot;beforeSend&quot;</span>,  </span><br><span class="line">    <span class="string">&quot;after-send-file&quot;</span>:<span class="string">&quot;afterSendFile&quot;</span>,  </span><br><span class="line">&#125;,&#123;  </span><br><span class="line">    <span class="comment">//时间点1：所有分块进行上传之前调用此函数  </span></span><br><span class="line">    <span class="attr">beforeSendFile</span>:<span class="function"><span class="keyword">function</span>(<span class="params">file</span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">var</span> deferred = WebUploader.Deferred();  </span><br><span class="line">        <span class="comment">//1、计算文件的唯一标记，用于断点续传  </span></span><br><span class="line">        (<span class="keyword">new</span> WebUploader.Uploader()).md5File(file)  </span><br><span class="line">            .progress(<span class="function"><span class="keyword">function</span>(<span class="params">percentage</span>)</span>&#123;  </span><br><span class="line">                $(<span class="string">&#x27;#item1&#x27;</span>).find(<span class="string">&quot;p.state&quot;</span>).text(<span class="string">&quot;正在读取文件信息...&quot;</span>);  </span><br><span class="line">            &#125;)  </span><br><span class="line">            .then(<span class="function"><span class="keyword">function</span>(<span class="params">val</span>)</span>&#123;  </span><br><span class="line">                fileMd5=val;  </span><br><span class="line">                $(<span class="string">&#x27;#item1&#x27;</span>).find(<span class="string">&quot;p.state&quot;</span>).text(<span class="string">&quot;成功获取文件信息...&quot;</span>);  </span><br><span class="line">                <span class="comment">//获取文件信息后进入下一步  </span></span><br><span class="line">                deferred.resolve();  </span><br><span class="line">            &#125;);  </span><br><span class="line">        <span class="keyword">return</span> deferred.promise();  </span><br><span class="line">    &#125;,  </span><br><span class="line">    <span class="comment">//时间点2：如果有分块上传，则每个分块上传之前调用此函数  </span></span><br><span class="line">    <span class="attr">beforeSend</span>:<span class="function"><span class="keyword">function</span>(<span class="params">block</span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">var</span> deferred = WebUploader.Deferred();  </span><br><span class="line">          </span><br><span class="line">        $.ajax(&#123;  </span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;POST&quot;</span>,  </span><br><span class="line">            <span class="attr">url</span>:<span class="string">&quot;uploadVideo.php&quot;</span>,  </span><br><span class="line">            <span class="attr">data</span>:&#123;  </span><br><span class="line">                <span class="comment">//文件唯一标记  </span></span><br><span class="line">                <span class="attr">fileMd5</span>:fileMd5,  </span><br><span class="line">                <span class="comment">//当前分块下标  </span></span><br><span class="line">                <span class="attr">chunk</span>:block.chunk,  </span><br><span class="line">                <span class="comment">//当前分块大小  </span></span><br><span class="line">                <span class="attr">chunkSize</span>:block.end-block.start ,</span><br><span class="line">                <span class="string">&#x27;option&#x27;</span>:<span class="string">&#x27;checkChunk&#x27;</span>,</span><br><span class="line">            &#125;,  </span><br><span class="line">            <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span>,  </span><br><span class="line">            <span class="attr">success</span>:<span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;  </span><br><span class="line">                <span class="keyword">if</span>(response.status == <span class="string">&#x27;error&#x27;</span>)&#123;  </span><br><span class="line">                    <span class="comment">//分块存在，跳过  </span></span><br><span class="line">                    deferred.reject();  </span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="comment">//分块不存在或不完整，重新发送该分块内容  </span></span><br><span class="line">                    deferred.resolve();  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;);  </span><br><span class="line">          </span><br><span class="line">        <span class="built_in">this</span>.owner.options.formData.fileMd5 = fileMd5;  </span><br><span class="line">        deferred.resolve();  </span><br><span class="line">        <span class="keyword">return</span> deferred.promise();  </span><br><span class="line">    &#125;,  </span><br><span class="line">    <span class="comment">//时间点3：所有分块上传成功后调用此函数  </span></span><br><span class="line">    <span class="attr">afterSendFile</span>:<span class="function"><span class="keyword">function</span>(<span class="params">block</span>)</span>&#123;  </span><br><span class="line">        <span class="comment">//如果分块上传成功，则通知后台合并分块  </span></span><br><span class="line">        $.ajax(&#123;  </span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;POST&quot;</span>,  </span><br><span class="line">            <span class="attr">url</span>:<span class="string">&quot;uploadVideo.php&quot;</span>,  </span><br><span class="line">            <span class="attr">data</span>:&#123;  </span><br><span class="line">                <span class="attr">fileMd5</span>:fileMd5,</span><br><span class="line">                <span class="string">&#x27;option&#x27;</span>:<span class="string">&#x27;merge&#x27;</span>,</span><br><span class="line">            &#125;,  </span><br><span class="line">            <span class="attr">success</span>:<span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (response.status == <span class="string">&#x27;success&#x27;</span>) &#123;</span><br><span class="line">                	$(<span class="string">&#x27;input[name=url]&#x27;</span>).val(response.data.video_path);</span><br><span class="line">                	$(<span class="string">&#x27;.webuploader-pick&#x27;</span>).html(<span class="string">&#x27;视频上传成功&#x27;</span>);</span><br><span class="line">                	$(<span class="string">&#x27;#item1&#x27;</span>).html(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                	layui.msg(response.msg);</span><br><span class="line">                &#125;   </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);  </span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> uploader = WebUploader.create(&#123;  </span><br><span class="line">    <span class="comment">// swf文件路径  </span></span><br><span class="line">    <span class="attr">swf</span>: <span class="string">&#x27;/Public/webuploader/Uploader.swf&#x27;</span>,  </span><br><span class="line">    <span class="comment">// 文件接收服务端。  </span></span><br><span class="line">    <span class="attr">server</span>:<span class="string">&quot;uploadVideo.php&quot;</span>,  </span><br><span class="line">    <span class="comment">// 选择文件的按钮。可选。  </span></span><br><span class="line">    <span class="comment">// 内部根据当前运行是创建，可能是input元素，也可能是flash.  </span></span><br><span class="line">    <span class="attr">pick</span>: &#123;<span class="attr">id</span>: <span class="string">&#x27;#filePicker&#x27;</span>,<span class="attr">multiple</span>:<span class="literal">true</span>&#125;,  </span><br><span class="line">    <span class="comment">// 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！  </span></span><br><span class="line">    <span class="attr">resize</span>: <span class="literal">true</span>,  </span><br><span class="line">    <span class="attr">auto</span>:<span class="literal">true</span>,  </span><br><span class="line">    <span class="comment">//开启分片上传  </span></span><br><span class="line">    <span class="attr">chunked</span>: <span class="literal">true</span>,  </span><br><span class="line">    <span class="attr">chunkSize</span>: <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>,  </span><br><span class="line">      </span><br><span class="line">    <span class="attr">accept</span>: &#123;  </span><br><span class="line">    <span class="comment">//限制上传文件为MP4  </span></span><br><span class="line">        <span class="attr">extensions</span>:<span class="string">&#x27;mp4&#x27;</span>,  </span><br><span class="line">        <span class="attr">mimeTypes</span>: <span class="string">&#x27;video/mp4&#x27;</span>,  </span><br><span class="line">    &#125;,  </span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line"><span class="comment">// 文件上传过程中创建进度条实时显示。  </span></span><br><span class="line">uploader.on( <span class="string">&#x27;uploadProgress&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> file, percentage </span>) </span>&#123;</span><br><span class="line">	$(<span class="string">&#x27;.webuploader-pick&#x27;</span>).html(<span class="string">&#x27;视频正在上传中...&#x27;</span>+<span class="built_in">Math</span>.round(percentage * <span class="number">100</span>) + <span class="string">&#x27;%&#x27;</span>); </span><br><span class="line">&#125;);  </span><br><span class="line">  </span><br><span class="line">uploader.on( <span class="string">&#x27;uploadError&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> file </span>) </span>&#123;  </span><br><span class="line">	$(<span class="string">&#x27;.webuploader-pick&#x27;</span>).html(<span class="string">&#x27;视频出错了&#x27;</span>);</span><br><span class="line">	$(<span class="string">&#x27;#item1&#x27;</span>).html(<span class="string">&#x27;&#x27;</span>);  </span><br><span class="line">	</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>后端利用的是php，不一定适合你的项目，可以做修改这里只是提供思路,可到github看官方的列子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">uploadVideo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">//视频块的大小</span></span><br><span class="line">    <span class="comment">//设置上传的目录</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$upload_path</span> = <span class="string">&#x27;./VideoTemp/&#x27;</span>;</span><br><span class="line">    <span class="comment">//文件格式</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$exts</span> = [<span class="string">&#x27;mp4&#x27;</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$tem_path</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$allow_host</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">//视频地址</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$host</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">//资源大小</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$size</span> = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="comment">// header(&#x27;Access-Control-Allow-Origin:&#x27; . $this-&gt;allow_host);</span></span><br><span class="line">        header(<span class="string">&#x27;Access-Control-Allow-Origin:*&#x27;</span>);<span class="comment">//项目要求跨域，解决跨域请求</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$_POST</span>;</span><br><span class="line">        <span class="comment">//检查块是否上传</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$data</span>[<span class="string">&#x27;option&#x27;</span>] == <span class="string">&#x27;checkChunk&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;checkChunk();</span><br><span class="line">            <span class="comment">//合并视频块</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$data</span>[<span class="string">&#x27;option&#x27;</span>] == <span class="string">&#x27;merge&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;merge();</span><br><span class="line">            <span class="comment">//上传资源</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;uploadFile();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">uploadFile</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$_POST</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="comment">//临时目录,以上传文件md5加密</span></span><br><span class="line">        <span class="variable">$tem_path</span> = <span class="keyword">$this</span>-&gt;upload_path.<span class="variable">$data</span>[<span class="string">&#x27;fileMd5&#x27;</span>].<span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//检测上传视频的格式</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$ext</span> = <span class="keyword">$this</span>-&gt;checkExt(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;ajaxError(<span class="string">&#x27;视频格式只能mp4&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建临时目录</span></span><br><span class="line">        <span class="keyword">if</span> (!is_dir(<span class="variable">$tem_path</span>)) &#123;</span><br><span class="line">            mkdir(<span class="variable">$tem_path</span>,<span class="number">0777</span>,<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//组装块名</span></span><br><span class="line">        <span class="variable">$file_name</span> = <span class="variable">$data</span>[<span class="string">&#x27;fileMd5&#x27;</span>] . <span class="string">&#x27;_&#x27;</span> . <span class="variable">$data</span>[<span class="string">&#x27;chunk&#x27;</span>];</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="variable">$file_name</span>.<span class="string">&#x27;.&#x27;</span> .<span class="variable">$ext</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//上传块</span></span><br><span class="line">        <span class="variable">$result</span> =move_uploaded_file(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$tem_path</span>.<span class="variable">$file_name</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span> == <span class="literal">false</span> ? <span class="keyword">$this</span>-&gt;ajaxError(<span class="string">&#x27;文件上传失败&#x27;</span>) : <span class="keyword">$this</span>-&gt;ajaxSuccess(<span class="string">&#x27;文件上传成功&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">checkExt</span>(<span class="params"><span class="variable">$filename</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ext</span> = array_pop(explode(<span class="string">&#x27;.&#x27;</span>,<span class="variable">$filename</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> in_array(<span class="variable">$ext</span>, <span class="keyword">$this</span>-&gt;exts) ? <span class="variable">$ext</span> : <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">checkChunk</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$_POST</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$file_name</span> = <span class="variable">$data</span>[<span class="string">&#x27;fileMd5&#x27;</span>] . <span class="string">&#x27;_&#x27;</span> . <span class="variable">$data</span>[<span class="string">&#x27;chunk&#x27;</span>] . <span class="string">&#x27;.mp4&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//视频块路径</span></span><br><span class="line">        <span class="variable">$blocks_path</span> = <span class="keyword">$this</span>-&gt;upload_path.<span class="variable">$data</span>[<span class="string">&#x27;fileMd5&#x27;</span>].<span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> file_exists(<span class="variable">$blocks_path</span>.<span class="variable">$file_name</span>) ? <span class="keyword">$this</span>-&gt;ajaxError(<span class="string">&#x27;该块已经上传过&#x27;</span>) : <span class="keyword">$this</span>-&gt;ajaxSuccess(<span class="string">&#x27;上传成功&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">ajaxError</span>(<span class="params"><span class="variable">$msg</span>=<span class="string">&#x27;&#x27;</span>, <span class="variable">$fields</span>=<span class="keyword">array</span>(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        header(<span class="string">&#x27;Content-Type:application/json; charset=utf-8&#x27;</span>);</span><br><span class="line">        <span class="variable">$data</span> = <span class="keyword">array</span>(<span class="string">&#x27;status&#x27;</span>=&gt;<span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;msg&#x27;</span>=&gt;<span class="variable">$msg</span>, <span class="string">&#x27;fields&#x27;</span>=&gt;<span class="variable">$fields</span>);</span><br><span class="line">        <span class="keyword">echo</span> json_encode(<span class="variable">$data</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">ajaxSuccess</span>(<span class="params"><span class="variable">$msg</span>, <span class="variable">$_data</span>=<span class="keyword">array</span>(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        header(<span class="string">&#x27;Content-Type:application/json; charset=utf-8&#x27;</span>);</span><br><span class="line">        <span class="variable">$data</span> = <span class="keyword">array</span>(<span class="string">&#x27;status&#x27;</span>=&gt;<span class="string">&#x27;success&#x27;</span>, <span class="string">&#x27;msg&#x27;</span> =&gt; <span class="variable">$msg</span> ,<span class="string">&#x27;data&#x27;</span>=&gt;<span class="variable">$_data</span>);</span><br><span class="line">        <span class="keyword">echo</span> json_encode(<span class="variable">$data</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">merge</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$_POST</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//视频块临时目录</span></span><br><span class="line">        <span class="variable">$block_path</span> = <span class="keyword">$this</span>-&gt;upload_path.<span class="variable">$data</span>[<span class="string">&#x27;fileMd5&#x27;</span>].<span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//chunks数量</span></span><br><span class="line">        <span class="variable">$chunksArray</span> = glob(<span class="variable">$block_path</span>.<span class="string">&#x27;*.mp4&#x27;</span>);</span><br><span class="line">        <span class="variable">$numbers</span> = count(<span class="variable">$chunksArray</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//合并视频地址</span></span><br><span class="line">        <span class="variable">$mergeFileName</span> = <span class="keyword">$this</span>-&gt;upload_path . <span class="variable">$data</span>[<span class="string">&#x27;fileMd5&#x27;</span>] .<span class="string">&#x27;.mp4&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//每次读取资源大小2M</span></span><br><span class="line">        <span class="variable">$filezie</span> = <span class="keyword">$this</span>-&gt;size * <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//处理视频块地址</span></span><br><span class="line">        <span class="variable">$fp2</span> = fopen(<span class="variable">$mergeFileName</span>,<span class="string">&quot;wb+&quot;</span>);<span class="comment">//二进制方法打开</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( flock(<span class="variable">$fp2</span>, LOCK_EX) ) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="variable">$key</span> = <span class="number">0</span> ; <span class="variable">$key</span> &lt; <span class="variable">$numbers</span> ; <span class="variable">$key</span>++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="variable">$path</span> = <span class="variable">$block_path</span> . <span class="variable">$data</span>[<span class="string">&#x27;fileMd5&#x27;</span>] . <span class="string">&#x27;_&#x27;</span> . <span class="variable">$key</span> . <span class="string">&#x27;.mp4&#x27;</span>;</span><br><span class="line"></span><br><span class="line">                <span class="variable">$fp</span> = fopen(<span class="variable">$path</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (<span class="variable">$buff</span> = fread(<span class="variable">$fp</span>, <span class="variable">$filezie</span>)) &#123;</span><br><span class="line">                    fwrite(<span class="variable">$fp2</span>, <span class="variable">$buff</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">unset</span>(<span class="variable">$buff</span>);</span><br><span class="line"></span><br><span class="line">                fclose(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            flock(<span class="variable">$fp2</span>, LOCK_UN);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fclose(<span class="variable">$fp2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//验证视频的散列值是否一致</span></span><br><span class="line">        <span class="keyword">if</span> (md5_file(<span class="variable">$mergeFileName</span>) == <span class="variable">$data</span>[<span class="string">&#x27;fileMd5&#x27;</span>]) &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$chunksArray</span> <span class="keyword">as</span> <span class="variable">$vo</span>) &#123;</span><br><span class="line">               <span class="comment">//删除视频块</span></span><br><span class="line">               unlink(<span class="variable">$vo</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//删除临时文件夹</span></span><br><span class="line">            rmdir(<span class="variable">$block_path</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">$this</span>-&gt;ajaxSuccess(<span class="string">&#x27;视频上传成功&#x27;</span>,[<span class="string">&#x27;video_path&#x27;</span> =&gt; <span class="keyword">$this</span>-&gt;host . ltrim(<span class="variable">$mergeFileName</span>,<span class="string">&#x27;.&#x27;</span>)]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;ajaxError(<span class="string">&#x27;视频上传失败&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$uploadVideo</span> = <span class="keyword">new</span> uploadVideo2();</span><br><span class="line"></span><br><span class="line"><span class="variable">$uploadVideo</span>-&gt;upload();</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://jaguarjack.github.io/2017/02/03/centos7-edit-firewalld/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/./images/avatar.jpg">
      <meta itemprop="name" content="JaguarJack">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JaguarJack's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/02/03/centos7-edit-firewalld/" class="post-title-link" itemprop="url">centOS7 防火墙 以及修改成iptables</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-02-03 10:52:10" itemprop="dateCreated datePublished" datetime="2017-02-03T10:52:10Z">2017-02-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-16 01:05:39" itemprop="dateModified" datetime="2021-06-16T01:05:39Z">2021-06-16</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">服务器运维</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>centos7 默认使用firewalld防火墙配置，以及修改iptables</p>
<h3 id="开启服务"><a href="#开启服务" class="headerlink" title="开启服务"></a>开启服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start firewalld.service</span><br></pre></td></tr></table></figure>

<h3 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld.service</span><br></pre></td></tr></table></figure>

<h3 id="开机自动启动"><a href="#开机自动启动" class="headerlink" title="开机自动启动"></a>开机自动启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> firewalld.service</span><br></pre></td></tr></table></figure>

<h3 id="关闭开机制动启动"><a href="#关闭开机制动启动" class="headerlink" title="关闭开机制动启动"></a>关闭开机制动启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> firewalld.service</span><br></pre></td></tr></table></figure>

<h3 id="查看状态"><a href="#查看状态" class="headerlink" title="查看状态"></a>查看状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld</span><br></pre></td></tr></table></figure>

<h3 id="查看状态-1"><a href="#查看状态-1" class="headerlink" title="查看状态"></a>查看状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --state    //running 表示运行</span><br></pre></td></tr></table></figure>

<h3 id="获取活动的区域"><a href="#获取活动的区域" class="headerlink" title="获取活动的区域"></a>获取活动的区域</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --get-active-zones</span><br></pre></td></tr></table></figure>

<h3 id="获取所有支持的服务"><a href="#获取所有支持的服务" class="headerlink" title="获取所有支持的服务"></a>获取所有支持的服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --get-service</span><br></pre></td></tr></table></figure>

<h3 id="在不改变状态的条件下重新加载防火墙："><a href="#在不改变状态的条件下重新加载防火墙：" class="headerlink" title="在不改变状态的条件下重新加载防火墙："></a>在不改变状态的条件下重新加载防火墙：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p>防火墙预定义的服务配置文件是xml文件 目录在 /usr/lib/firewalld/services/</p>
<p>在 /etc/firewalld/services/ 这个目录中也有配置文件    但是/etc/firewalld/services/目录 优先于 /usr/lib/firewalld/services/  目录</p>
<p>修改配置文件后 使用命令重新加载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p>启用某个服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-service=https   //临时</span><br><span class="line">firewall-cmd --permanent --zone=public --add-service=https  //永久</span><br></pre></td></tr></table></figure>

<p>开启某个端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone=public --add-port=8080-8081/tcp  //永久</span><br><span class="line">firewall-cmd  --zone=public --add-port=8080-8081/tcp   //临时</span><br></pre></td></tr></table></figure>

<p>使用命令加载设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p>查看开启的端口和服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone=public --list-services    //服务空格隔开  例如 dhcpv6-client https ss   </span><br><span class="line">firewall-cmd --permanent --zone=public --list-ports //端口空格隔开  例如  8080-8081/tcp 8388/tcp 80/tcp</span><br></pre></td></tr></table></figure>

<p>在每次修改 端口和服务后  /etc/firewalld/zones/public.xml  文件就会被修改   所以也可以在文件中之间修改  然后重新加载</p>
<h3 id="删除上面设置的规则"><a href="#删除上面设置的规则" class="headerlink" title="删除上面设置的规则"></a>删除上面设置的规则</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#firewall-cmd --permanent --zone=public --remove-rich-rule=&quot;rule family=&quot;ipv4&quot;  source address=&quot;192.168.0.4/24&quot; service name=&quot;http&quot; accept&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl start firewalld.service  //开启服务</span><br><span class="line">systemctl <span class="built_in">enable</span> firewalld.service //开机制动启动</span><br><span class="line">systemctl stop firewalld.service  //关闭服务</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service //禁止开机启动</span><br></pre></td></tr></table></figure>

<h3 id="安装iptables防火墙-在这之前关闭firewalld"><a href="#安装iptables防火墙-在这之前关闭firewalld" class="headerlink" title="安装iptables防火墙(在这之前关闭firewalld)"></a>安装iptables防火墙(在这之前关闭firewalld)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install iptables-services <span class="comment">#安装</span></span><br><span class="line">vi /etc/sysconfig/iptables <span class="comment">#编辑防火墙配置文件</span></span><br><span class="line">systemctl restart iptables.service <span class="comment">#最后重启防火墙使配置生效</span></span><br><span class="line">systemctl <span class="built_in">enable</span> iptables.service <span class="comment">#设置防火墙开机启动</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2015 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JaguarJack</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  




  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<script class="next-config" data-name="utterances" type="application/json">{&quot;enable&quot;:true,&quot;repo&quot;:&quot;JaguarJack&#x2F;JaguarJack.github.io&quot;,&quot;issue_term&quot;:&quot;url&quot;,&quot;theme&quot;:&quot;boxy-light&quot;}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
